var msie=AppUtils.isIE();var active_num=-1;var last_num=-1;var show_thumb_number=false;var slideshow_flag=false;var timerID=undefined;var tStart=null;var timeout=null;var slideshow_time=10;var image_list=null;var images_total=0;var create_thumbnails=false;var active_id=null;var max_image_width=0;var max_image_height=0;var base_url="./content/phpigallery/galleries/";var gallery_dir="gallery";function iGalleryCompleteHandler(A){cleanupNodes();Behaviour.apply()}function reloadGallery(A,C){var D="./content/phpigallery/content_iGallery.php";var B="thumbsContent=thumbs&iGalleryThumbs="+A+"&iGalleryName="+C;return ajaxRequest(D,showThumbnailsResponse,ajaxErrorHandler,B)}function getGalleryThumbnails(D,C,A){gallery_dir=AppUtils.trim(C);D=base_url+gallery_dir;var E="./content/phpigallery/content_iGallery.php";var B="thumbsContent=thumbs&iGalleryThumbs="+D+"&iGalleryName="+gallery_dir;return ajaxRequest(E,showThumbnailsResponse,ajaxErrorHandler,B,iGalleryCompleteHandler)}function showThumbnailsResponse(A){var B=$("gallery_data");if(B!=null){B.innerHTML=A.responseText;showToolsMenu()}}function explodeThumbnailDetails(A){var B=null;if(A!=null){var C=A.innerHTML.substring();var D=new Array();D=C.split(";");if((C.length>0)&&(D.length>4)){B=new Object();B.image=D[0];B.name=imageName(D[1]);B.width=D[2];B.height=D[3];B.thumb=D[4]}}return B}function zero(A){if(A<10){A="0"+A}return A}function nextImageSlideshow(){var A=((Math.floor(active_num)+1)<image_list.length)?Math.floor(active_num)+1:0;getImage(A,image_list[A]["image"],image_list[A]["name"]);startTimer()}function firstImageSlideshow(){var A=Math.floor(active_num);A=(A<0)?0:A;getImage(A,image_list[A]["image"],image_list[A]["name"]);startTimer()}function updateTimer(){if(timerID){clearTimeout(timerID);clockID=0}if(!tStart){tStart=new Date()}var A=new Date();var B=A.getTime()-tStart.getTime();A.setTime(B);innerhtml("time",zero(slideshow_time-A.getSeconds())+" seconds");timerID=setTimeout("updateTimer()",1000)}function startTimer(){clearTimeout(timerID);clearTimeout(timeout);tStart=new Date();innerhtml("time",zero(slideshow_time)+" seconds");updateTimer();timeout=setTimeout("nextImageSlideshow();",1000*slideshow_time)}function startSlideshow(){changeSlideshowTime($("slideshowTimeSelect"));var B=$("list_0");if(B==null){var A=AppUtils.getClassOfWindow();AppUtils.openThemeDialog(A,"Select a Gallery before starting slideshow",true);return }if(!slideshow_flag){clearTimeout(timerID);clearTimeout(timeout);timeout=null;innerhtml("toggle_show","pause slideshow");firstImageSlideshow();slideshow_flag=true}else{if(timerID){clearTimeout(timerID)}if(timeout){clearTimeout(timeout)}timeout=null;innerhtml("toggle_show","resume slideshow");slideshow_flag=false}display("msc_image","block");display("timer","block")}function changeSlideshowTime(A){slideshow_time=A.value}function prevImage(){var A=(Math.floor(active_num)>=0)?Math.floor(active_num)-1:-1;if(A>=0){getImage(A,image_list[A]["image"],image_list[A]["name"]);setupPreloadOfNextAvailableImage(A,-1)}if(slideshow_flag){startTimer()}}function nextImage(){var A=((Math.floor(active_num)+1)<image_list.length)?Math.floor(active_num)+1:false;if(A!=false){getImage(A,image_list[A]["image"],image_list[A]["name"])}if(slideshow_flag){startTimer()}}function closeImageWin(){enableDockBar();active_img="";if(slideshow_flag){if(timerID){clearTimeout(timerID)}if(timeout){clearInterval(timeout)}active_num=0;slideshow_flag=false}$("thumbs_ul").style.opacity=1;display("timer","none");display("msc_image","none");innerhtml("img","");innerhtml("image_title","");innerhtml("nav_thumbs","")}function showToolsMenu(){var A=$("utilities");if(A.style.display!="block"){innerhtml("toolshowhide","Hide tools");display("utilities","block")}}function toolToggle(){var A=$("utilities");if(A.style.display=="block"){innerhtml("toolshowhide","Show tools");display("utilities","none")}else{innerhtml("toolshowhide","Hide tools");display("utilities","block")}}function imageName(A){var C=A.split("/");var B=C[C.length-1];if(!show_thumb_number){B=B.replace(/^[0-9]*_/g,"")}B=B.replace(/\_/g," ").replace(/\-/g," - ");B=B.replace(/\.[A-Za-z0-9]*$/g,"");return B}function checkNavigation(B){var D=Math.floor(B);var A=(D>0)?"inline":"none";var C=((D+1)<image_list.length)?"inline":"none";display("a_prev",A);display("a_next",C)}function innerhtml(C,A){var B=$(C);if(B!=null){if(A==null){A="NULL Content Data for id=["+C+"]"}B.innerHTML=A}}function display(C,A){var B=$(C);if(B!=null){B.style.display=A}}function getImage(G,O,P){if(0<=G){setupPreloadOfNextAvailableImage(G,1);display("img","block");active_id=O;var L=base_url+gallery_dir+"/"+O.substring(O.indexOf("/")+1);var B="";B+='<div id="loaddiv"><img id="loadimg" src="'+L+'" /> <br/><strong>'+imageName(P)+"</strong></div>";innerhtml("img",B);var J=$("loaddiv");J.style.display="block";active_num=Math.floor(G);var D=$("thimg_"+G);var I=$("list_"+G);var H=$("thimg_"+last_num);var E=$("list_"+last_num);I.className="selected";if(last_num&&last_num!=active_num){if(E!=null){E.className="visited"}}last_num=G;var N="<small>loading image: <strong>"+imageName(P)+"</strong>...</small>";innerhtml("image_title",N);var F=$("msc_image");if(!msie){F.style.position="fixed"}display("msc_image","block");checkNavigation(G);var M=$("thumbInfoList_"+G);if(M!=null){var A="";A=M.innerHTML.substring();updateImage(G,A)}disableDockBar();var K=AppUtils.getPageSize();var C=$("image_bg");C.style.width=K.windowWidth+"px";C.style.height=(K.windowHeight+200)+"px"}else{alert("element is null")}}function updateImage(F,J){var I=null;if(image_list[F]!=null){I=image_list[F]}else{I=explodeThumbnailDetails(J)}var H=F;var R=I.image;var S=I.name;var K=Math.floor(I.width);var O=Math.floor(I.height);var M=base_url+gallery_dir+"/"+R.substring(R.indexOf("/")+1);var P=K;var D=O;var G=false;var N="<strong>"+imageName(S)+"</strong> <small>"+K+"x"+O+"px (loading "+H+" of "+images_total+")</small>";var B="";setMaxSizes();var C=false;if(D>max_image_height){D=max_image_height;P=Math.round((K*max_image_height)/O);if(P>max_image_width){dw=P;dh=D;P=max_image_width;D=Math.round((dh*max_image_width)/dw)}C=true}var E=(D>P)?D:P;var A=P;var L=D;var Q=$("img");Q.style.width=Math.round(P+18)+"px";Q.style.height=Math.round(D+18)+"px";B='<img id="mainimg" class="imagen" src="'+M+'"  width="'+A+'" height="'+L+'" title="'+S+'" alt="'+S+'" />';B+='<p><a href="'+M+'" target="_blank"><small>Full Image new window</small></a></p>';innerhtml("img",B);innerhtml("image_title",N);getNavThumbs()}function setupPreloadOfNextAvailableImage(C,D){if(0<=C){var B=0;if(D!=null&&D<0){B=((C-1)>=0)?(C-1):(images_total-1)}else{B=((C+1)<images_total)?(C+1):0}if(image_list!=null){var F=image_list[B]["image"];var E=base_url+gallery_dir+"/"+F.substring(F.indexOf("/")+1);var A="";A+='<img id="img_preload" class="bhv_Invisible" src="'+E+'" />';innerhtml("hidden_preload",A)}}}function setMaxSizes(){var A=AppUtils.getPageSize();var C=(msie)?220:190;var B=$("timer");if(B.style.display=="block"){C+=16}max_image_width=Math.floor(A.widowWidth-100);max_image_height=Math.floor(A.windowHeight-C)}function getNavThumbs(){innerhtml("nav_thumbs","");var B="";var E=0;var A=((Math.floor(active_num)-1)>=0)?Math.floor(active_num)-1:false;while(E<5){if(A!==false){if(A<image_list.length){if(image_list[A]["image"]){var D=image_list[A]["image"];var C=image_list[A]["name"];B+='<div id="navthumb" title="'+C+'"><a href="javascript:;" ';B+='onclick="getImage('+A+",'"+D+"','"+C+"'); return false;\">";B+='&nbsp;<img class="';B+=(A==(active_num))?"sel":"th";B+='" src="';if(parseInt(image_list[A]["thumb"],10)>0){B+=base_url+gallery_dir+"/_thumbnails/"+D+'" />&nbsp;</a></div>'}else{B+=base_url+gallery_dir+"/"+D+'" />&nbsp;</a></div>'}}A++;E++}else{B+='<div id="navthumb">';B+='&nbsp;<img class="th" src="images/spacer.gif" width="44" height="44" />&nbsp;';B+="</div>";A++;E++}}else{A++;continue}}innerhtml("nav_thumbs",B)}function processHidenThumbDataInfo(B){if(isDebugMode()){console.info("Gallery: Debug")}image_list=null;image_list=new Array();var C=0;var A=0;do{var E=null;var D=$("thumbInfoList_"+C);E=explodeThumbnailDetails(D);if(E!=null){image_list[A++]=E}C++}while(E!=null);images_total=image_list.length}var my_iGallery_rules={"span.galleryRules":function(A){},".hidden_thumbdata":function(A){processHidenThumbDataInfo(A)},"#bar":function(A){A.onclick=function(){}}};Behaviour.register(my_iGallery_rules);